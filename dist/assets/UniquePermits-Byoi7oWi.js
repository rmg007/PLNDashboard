import{r,j as l,u as Z,e as ee,f as te}from"./index-6DsH3j6U.js";import{c as $,C as A,u as re,M as H,R as ae}from"./MultiSelectDropdown-DoJDWq2O.js";import"./plotly.min-D1u5EAZ6.js";const O=$();function se({valuationTableData:e,filteredValuationData:m,columns:P,isValuationLoading:p,pastelPalette:F}){const S=r.useMemo(()=>[O.accessor("FiscalYear",{header:"Fiscal Yr.",cell:x=>x.getValue(),enableSorting:!0,meta:{className:"text-center"}}),O.accessor("PermitCount",{header:"Permits Vol.",cell:x=>x.getValue().toLocaleString(),enableSorting:!0,meta:{className:"text-center"}})],[]),d=r.useMemo(()=>!e||e.length===0||m.length===0?[]:[...e].map(f=>f.permit_range).map(f=>{const u=m.filter(s=>s.permit_range===f).map(s=>({FiscalYear:s.year,PermitCount:s.count,AveragePermitsPerMonth:s.count/12}));return{permitRange:f,chartData:u}}),[e,m]);return d.length===0?null:l.jsx(l.Fragment,{children:[...d].reverse().map((x,f)=>{const i=`Permit Volume for Valuation Range: ${x.permitRange}`,u=F[f%F.length];return l.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-4 mt-8",children:l.jsx(A,{id:`chartValuationBin-${x.permitRange}`,data:x.chartData,columns:S,isLoading:p,chartTitle:i,xAxisTitle:"Fiscal Year",yAxisTitle:"Permit Count",xAccessor:"FiscalYear",yAccessor:"PermitCount",chartType:"bar",baseBarColor:u,showTrendLine:!0,excelFileName:`ValuationBin-${x.permitRange}.xlsx`,chartFileName:`ValuationBin-${x.permitRange}.png`,initialTableWidth:320,showTablePanel:!0,tableHeaderClassName:"text-center",showBarLabels:!0,barLabelPosition:"inside",barLabelInsideAnchor:"middle",barLabelFontSize:12,barLabelFontColor:"white",barLabelFormat:s=>s.toLocaleString(),dataLabelsOnLine:!0,dataLabelsFontSize:12,chartLayout:{legend:{orientation:"h",y:-.2}}})},`bin-chart-${f}`)})})}const R=$(),E=[R.accessor("FiscalYear",{header:"Fiscal Yr.",cell:e=>e.getValue(),enableSorting:!0,meta:{className:"text-center"}}),R.accessor("PermitCount",{header:"Permits Vol.",cell:e=>e.getValue().toLocaleString(),enableSorting:!0,meta:{className:"text-center"}}),R.accessor("AveragePermitsPerMonth",{header:"Monthly Avg.",cell:e=>Math.round(e.getValue()).toLocaleString(),enableSorting:!0,meta:{className:"text-center"}})];function le({data:e,isLoading:m,selectedItemsCount:P}){const p=["rgb(189, 135, 143)","rgb(5, 80, 105)","rgb(9, 107, 9)","rgb(126, 126, 7)","rgb(172, 124, 172)","rgb(173, 166, 99)","rgb(155, 180, 180)","rgb(167, 147, 145)","rgb(163, 175, 163)","rgb(184, 169, 174)","rgb(110, 110, 5)","rgb(230, 230, 250)"],[F,S]=r.useState([]),[d,x]=r.useState([]);r.useEffect(()=>{fetch("/data/UniquePermitsAnalysisData/UniquePermitYearlyBinsJson.json").then(n=>n.json()).then(n=>{S(n)}).catch(n=>console.error("Error loading valuation data:",n))},[]),r.useEffect(()=>{if(F.length===0||e.length===0)return;const n=e.map(o=>o.FiscalYear),a=F.filter(o=>n.includes(o.year));x(a)},[F,e]);const f=r.useMemo(()=>P===0?"Annual Permit Volume for All Years":P===1?"Annual Permit Volume for Selected Year":`Annual Permit Volume for ${P} Selected Years`,[P]),i=r.useMemo(()=>e.map(n=>({...n,AveragePermitsPerMonth:n.PermitCount/12})),[e]),u=r.useMemo(()=>[R.accessor("permit_range",{header:"Valuation Range",cell:n=>n.getValue(),enableSorting:!0,meta:{className:"text-center"}}),...Array.from(new Set(d.map(n=>n.year))).sort((n,a)=>n-a).map(n=>R.accessor(a=>{const o=d.find(c=>c.permit_range===a.permit_range&&c.year===n);return o?o.count:0},{id:`year_${n}`,header:n.toString(),cell:a=>a.getValue().toLocaleString(),enableSorting:!0,meta:{className:"text-center"}}))],[d]),s=r.useMemo(()=>d.length===0?[]:[...new Set(d.map(a=>a.permit_range))].map(a=>({permit_range:a})),[d]),h=r.useMemo(()=>{if(d.length===0)return[];const n=[...new Set(d.map(o=>o.year))].sort((o,c)=>o-c),a=[...new Set(d.map(o=>o.permit_range))];return n.map((o,c)=>{const g=d.filter(w=>w.year===o),b=a.map(w=>{const Q=g.find(U=>U.permit_range===w);return Q?Q.count:0});return{x:a,y:b,name:o.toString(),type:"bar",marker:{color:p[c%p.length]},text:b.map(w=>w>0?w.toLocaleString():""),textposition:"outside",insidetextanchor:"middle",textfont:{color:"#333",size:12},hovertemplate:`<b>Year:</b> ${o}<br><b>Range:</b> %{x}<br><b>Volume:</b> %{y}<extra></extra>`}})},[d,p]),t=r.useMemo(()=>m||F.length===0,[m,F]);return l.jsxs("div",{className:"annual-analysis-section h-full flex flex-col space-y-8",children:[l.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-4",children:l.jsx(A,{id:"chartAnnualUniquePermitsReport",data:i,columns:E,isLoading:m,chartTitle:f,xAxisTitle:"Fiscal Year",yAxisTitle:"Total Permits",xAccessor:"FiscalYear",yAccessor:"PermitCount",chartType:"bar",baseBarColor:p[0],showTrendLine:!0,excelFileName:"AnnualPermitReport.xlsx",chartFileName:"AnnualPermitReport.png",initialTableWidth:320,showTablePanel:!0,tableHeaderClassName:"text-center",showBarLabels:!0,barLabelPosition:"inside",barLabelInsideAnchor:"middle",barLabelFontSize:12,barLabelFontColor:"white",barLabelFormat:n=>n.toLocaleString(),dataLabelsOnLine:!0,dataLabelsFontSize:12,chartLayout:{legend:{orientation:"h",y:-.2}}})}),l.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-4",style:{minHeight:"1100px"},children:l.jsx(A,{id:"chartValuationThresholds",data:s,columns:u,isLoading:t,chartTitle:"Permit Volume by Unique Permit Numbers â€” Binned by Valuation Thresholds",xAxisTitle:"Valuation Range",yAxisTitle:"Permit Volume",traces:h,barMode:"group",showTrendLine:!1,showAverageLine:!1,showBarLabels:!0,barLabelPosition:"outside",barLabelInsideAnchor:"middle",barLabelFontColor:"#333",excelFileName:"ValuationThresholdReport.xlsx",chartFileName:"ValuationThresholdReport.png",excelSheetName:"Valuation Thresholds",showTablePanel:!0,initialSplitPos:60,showPagination:!1,showChartTypeSwitcher:!1,chartType:"bar",splitterOrientation:"horizontal",initialTableWidth:320,disableHighlighting:!0,disableSelection:!0,tableHeaderClassName:"text-center",chartLayout:{legend:{orientation:"h",y:-.2}}})}),l.jsx(se,{valuationTableData:s,filteredValuationData:d,columns:E,isValuationLoading:t,pastelPalette:p})]})}const V=$(),T=["rgb(220, 88, 42)","rgb(255, 159, 64)","rgb(153, 102, 51)","rgb(134, 100, 36)","rgb(210, 105, 30)","rgb(204, 121, 167)","rgb(240, 128, 128)","rgb(255, 205, 86)","rgb(201, 203, 207)","rgb(75, 192, 192)","rgb(0, 114, 178)","rgb(86, 180, 233)"];function ne({data:e,isLoading:m}){const P=r.useMemo(()=>[V.accessor("FiscalYear",{header:"Fiscal Yr.",meta:{className:"text-center"}}),V.accessor("FiscalQuarter",{header:"Quarter",cell:t=>`Q${t.getValue()}`,meta:{className:"text-center"}}),V.accessor("PermitCount",{header:"Permit Vol.",cell:t=>t.getValue().toLocaleString(),meta:{className:"text-center"}})],[]);r.useMemo(()=>[V.accessor("FiscalYear",{header:"Fiscal Year",meta:{className:"text-center"}}),V.accessor("PermitCount",{header:"Total Permits",cell:t=>t.getValue().toLocaleString(),meta:{className:"text-center"}})],[]);const p=r.useMemo(()=>[V.accessor("FiscalYear",{header:"Fiscal Year",meta:{className:"text-center"}}),V.accessor("PermitCount",{header:"Permit Count",cell:t=>t.getValue().toLocaleString(),meta:{className:"text-center"}})],[]),F=r.useMemo(()=>{if(!Array.isArray(e)||e.length===0)return[];const t=[...new Set(e.map(a=>a.FiscalYear))].sort((a,o)=>a-o),n=[];for(let a=1;a<=4;a++){const o=t.map(g=>{const b=e.find(w=>w.FiscalYear===g&&w.FiscalQuarter===a);return b?b.PermitCount:null}),c={x:t,y:o,name:`Q${a}`,text:o.map(g=>g?`Q${a}: ${g.toLocaleString()}`:""),hoverinfo:"y+name",hovertemplate:`<b>%{x} - Q${a}</b><br>Volume: %{y:,} permits<extra></extra>`,marker:{color:T[a-1%T.length]}};n.push({...c,type:"bar",textposition:"inside",insidetextanchor:"middle",textfont:{color:"white",size:11,family:"sans-serif"},textangle:-90,line:{color:T[a-1%T.length],width:3},mode:"lines+markers"})}return n},[e,T]);r.useMemo(()=>{if(!e||e.length===0)return[];const t={};return e.forEach(n=>{const a=n.FiscalYear;t[a]||(t[a]={FiscalYear:a,PermitCount:0}),t[a].PermitCount+=n.PermitCount}),Object.values(t).sort((n,a)=>n.FiscalYear-a.FiscalYear)},[e]);const S=r.useMemo(()=>{if(!e||e.length===0)return[];const t=[...new Set(e.map(o=>o.FiscalYear))].sort((o,c)=>o-c),n=[],a=[1,2,3,4];return t.forEach((o,c)=>{const g=a.map(b=>{const w=e.find(Q=>Q.FiscalYear===o&&Q.FiscalQuarter===b);return w?w.PermitCount:0});n.push({x:a.map(b=>`Q${b}`),y:g,name:`${o}`,type:"bar",marker:{color:T[c%T.length]},text:g.map((b,w)=>b?`${o}: ${b.toLocaleString()}`:""),textposition:"inside",insidetextanchor:"middle",textfont:{color:"white",size:11,family:"sans-serif"},textangle:-90,hoverinfo:"y+name",hovertemplate:`<b>${o} - %{x}</b><br>Volume: %{y:,} permits<extra></extra>`})}),n},[e,T]),d=r.useMemo(()=>e.filter(t=>t.FiscalQuarter===1),[e]),x=r.useMemo(()=>e.filter(t=>t.FiscalQuarter===2),[e]),f=r.useMemo(()=>e.filter(t=>t.FiscalQuarter===3),[e]),i=r.useMemo(()=>e.filter(t=>t.FiscalQuarter===4),[e]),u=r.useMemo(()=>{if(!e||e.length===0)return{min:0,max:100};const t=[...d.map(o=>o.PermitCount),...x.map(o=>o.PermitCount),...f.map(o=>o.PermitCount),...i.map(o=>o.PermitCount)].filter(o=>o!=null);if(t.length===0)return{min:0,max:100};const n=Math.floor(Math.min(...t)*.9),a=Math.ceil(Math.max(...t)*1.1);return{min:Math.max(0,n),max:a}},[e,d,x,f,i]),s=r.useMemo(()=>({yaxis:{range:[u.min,u.max],autorange:!1}}),[u]),h=r.useMemo(()=>{if(!Array.isArray(e)||e.length===0)return[];const t=[...e].sort((c,g)=>c.FiscalYear===g.FiscalYear?c.FiscalQuarter-g.FiscalQuarter:c.FiscalYear-g.FiscalYear),n=t.map(c=>`${c.FiscalYear}-Q${c.FiscalQuarter}`),a=t.map(c=>c.PermitCount);return[{x:n,y:a,type:"scatter",mode:"lines+markers",name:"Permit Volume Trend",line:{color:T[0],width:3},marker:{size:8,color:T[0]},hovertemplate:"<b>%{x}</b><br>Volume: %{y:,} permits<extra></extra>"}]},[e,T]);return l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"bg-white dark:bg-gray-800/50 p-4 rounded-lg shadow mb-8",id:"quarterly-trend-report",children:l.jsx(A,{id:"chart0_Quarterly_Trend",data:e,columns:P,isLoading:m,chartTitle:"Permit Volume by Unique Permit Numbers â€” Quarterly Trend",xAxisTitle:"Quarter",yAxisTitle:"Permit Volume",traces:h,chartType:"line",showTrendLine:!0,showAverageLine:!0,xAxisTickAngle:-45,showTablePanel:!0,initialSplitPos:80,initialTableWidth:350,tableHeaderClassName:"text-center",chartLayout:{showlegend:!1},excelFileName:"Quarterly-Trend-Report.xlsx",chartFileName:"Quarterly-Trend-Report.png",excelSheetName:"Quarterly Trend Data",showPagination:!0,showChartTypeSwitcher:!1,disableHighlighting:!1,disableSelection:!1})}),l.jsx("div",{className:"bg-white dark:bg-gray-800/50 p-4 rounded-lg shadow mb-8",id:"quarterly-grouped-report",children:l.jsx(A,{id:"chart1_Quarterly",data:e,columns:P,isLoading:m,chartTitle:"Permit Volume by Unique Permit Numbers â€” Quarterly Volumes",xAxisTitle:"Fiscal Year",yAxisTitle:"Permit Volume",traces:F,barMode:"group",showTrendLine:!1,showAverageLine:!1,showBarLabels:!0,showDataLabels:!0,dataLabelPosition:"outside",barLabelFontColor:"black",excelFileName:"Quarterly-Grouped-Report.xlsx",chartFileName:"Quarterly-Grouped-Report.png",excelSheetName:"Quarterly Grouped Data",showTablePanel:!0,initialSplitPos:80,initialTableWidth:350,tableHeaderClassName:"text-center",disableHighlighting:!0,disableSelection:!0,showPagination:!0,showChartTypeSwitcher:!1})}),l.jsx("div",{className:"bg-white dark:bg-gray-800/50 p-4 rounded-lg shadow",children:l.jsx(A,{id:"chart2_Quarterly",data:e,columns:P,isLoading:m,chartTitle:"Permit Volume by Unique Permit Numbers â€” Quarterly Volumes",xAxisTitle:"Fiscal Year",yAxisTitle:"Permit Volume",traces:S,barMode:"group",showTrendLine:!1,showAverageLine:!1,showBarLabels:!0,showDataLabels:!0,dataLabelPosition:"outside",barLabelFontColor:"black",showTablePanel:!0,initialSplitPos:80,initialTableWidth:350,tableHeaderClassName:"text-center",disableHighlighting:!0,disableSelection:!0,excelFileName:"Quarterly-Grouped-Report-2.xlsx",chartFileName:"Quarterly-Grouped-Report-2.png",excelSheetName:"Quarterly Grouped Data",showPagination:!0,showChartTypeSwitcher:!1})}),l.jsx("h3",{className:"text-xl font-semibold text-gray-800 dark:text-gray-200 mb-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:"Quarterly Breakdown by Specific Quarter"}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[l.jsx("div",{className:"bg-white dark:bg-gray-800/50 p-4 rounded-lg shadow",children:l.jsx(A,{id:"chart3_Quarterly_Q1",data:d,columns:p,isLoading:m,chartTitle:"Q1 Permits Over Years",xAxisTitle:"Fiscal Year",yAxisTitle:"Permit Count",xAccessor:"FiscalYear",yAccessor:"PermitCount",chartType:"line",baseBarColor:T[0],showTablePanel:!1,initialSplitPos:100,hideSplitter:!0,chartLayout:{...s,showlegend:!1},chartFileName:"Q1-Permits-Chart.png",showTrendLine:!1,showAverageLine:!0,showTableToggle:!1,showDataLabels:!0,dataLabelPosition:"outside"})}),l.jsx("div",{className:"bg-white dark:bg-gray-800/50 p-4 rounded-lg shadow",children:l.jsx(A,{id:"chart4_Quarterly_Q2",data:x,columns:p,isLoading:m,chartTitle:"Q2 Permits Over Years",xAxisTitle:"Fiscal Year",yAxisTitle:"Permit Count",xAccessor:"FiscalYear",yAccessor:"PermitCount",initialChartType:"line",showChartTypeSwitcher:!0,baseBarColor:T[1],barLabelPosition:"inside",barLabelInsideAnchor:"middle",dataLabelFontColor:"black",barLabelFontColor:"white",showTablePanel:!1,initialSplitPos:100,hideSplitter:!0,chartLayout:{...s,showlegend:!1},chartFileName:"Q2-Permits-Chart.png",showTrendLine:!1,showAverageLine:!0,showTableToggle:!1,showDataLabels:!0})}),l.jsx("div",{className:"bg-white dark:bg-gray-800/50 p-4 rounded-lg shadow",children:l.jsx(A,{id:"chart5_Quarterly_Q3",data:f,columns:p,isLoading:m,chartTitle:"Q3 Permits Over Years",xAxisTitle:"Fiscal Year",yAxisTitle:"Permit Count",xAccessor:"FiscalYear",yAccessor:"PermitCount",initialChartType:"line",showChartTypeSwitcher:!0,baseBarColor:T[2],barLabelPosition:"inside",barLabelInsideAnchor:"middle",dataLabelFontColor:"black",barLabelFontColor:"white",showTablePanel:!1,initialSplitPos:100,hideSplitter:!0,chartLayout:{...s,showlegend:!1},chartFileName:"Q3-Permits-Chart.png",showTrendLine:!1,showAverageLine:!0,showTableToggle:!1,showDataLabels:!0})}),l.jsx("div",{className:"bg-white dark:bg-gray-800/50 p-4 rounded-lg shadow",children:l.jsx(A,{id:"chart6_Quarterly_Q4",data:i,columns:p,isLoading:m,chartTitle:"Q4 Permits Over Years",xAxisTitle:"Fiscal Year",yAxisTitle:"Permit Count",xAccessor:"FiscalYear",yAccessor:"PermitCount",showTableToggle:!1,initialChartType:"line",showChartTypeSwitcher:!0,baseBarColor:T[3],barLabelPosition:"inside",barLabelInsideAnchor:"middle",dataLabelFontColor:"black",barLabelFontColor:"white",showTablePanel:!1,initialSplitPos:100,hideSplitter:!0,chartLayout:{...s,showlegend:!1},chartFileName:"Q4-Permits-Chart.png",showTrendLine:!1,showAverageLine:!0,showDataLabels:!0})})]})]})}const N=$(),L=["rgb(54, 84, 134)","rgb(75, 123, 236)","rgb(102, 51, 153)","rgb(153, 102, 255)","rgb(201, 203, 207)","rgb(54, 162, 235)","rgb(0, 200, 83)","rgb(210, 105, 30)","rgb(128, 0, 128)","rgb(63, 81, 181)","rgb(240, 228, 66)","rgb(255, 99, 132)"],J=["January","February","March","April","May","June","July","August","September","October","November","December"];function oe({data:e,isLoading:m}){const P=r.useMemo(()=>[N.accessor("FiscalYear",{header:"Fiscal Year",cell:i=>i.getValue(),enableSorting:!0}),N.accessor("FiscalMonth",{header:"Month",cell:i=>i.getValue(),enableSorting:!0}),N.accessor("PermitCount",{header:"Permit Count",cell:i=>i.getValue().toLocaleString(),enableSorting:!0})],[]);r.useMemo(()=>[N.accessor("FiscalYear",{header:"Fiscal Year",cell:i=>i.getValue(),enableSorting:!0}),N.accessor("FiscalQuarter",{header:"Quarter",cell:i=>`Q${i.getValue()}`,enableSorting:!0}),N.accessor("FiscalMonth",{header:"Month",cell:i=>i.getValue(),enableSorting:!0}),N.accessor("PermitCount",{header:"Permit Count",cell:i=>i.getValue().toLocaleString(),enableSorting:!0})],[]);const p=r.useMemo(()=>[N.accessor("FiscalYear",{header:"Fiscal Year",cell:i=>i.getValue(),enableSorting:!0}),N.accessor("PermitCount",{header:"Permit Count",cell:i=>i.getValue().toLocaleString(),enableSorting:!0})],[]);r.useCallback((i="")=>{let u="Monthly Permit Volume";if(e&&e.length>0){const s=[...new Set(e.map(h=>h.FiscalYear))].sort((h,t)=>h-t);s.length===1?u+=` for FY ${s[0]}`:s.length>1&&s.length<=3?u+=` for FY ${s.join(", ")}`:s.length>3&&(u+=" for Selected Years")}if(e&&e.length>0){const s=[...new Set(e.map(h=>h.FiscalMonth))];if(s.length===1){const h=s[0],t=J.findIndex(n=>n.substring(0,3)===h);t!==-1&&(u+=` ${J[t]}`)}}return`${u} ${i}`.trim()},[e]);const F=r.useMemo(()=>{if(!e||e.length===0)return[];const i=[...new Set(e.map(h=>h.FiscalYear))].sort((h,t)=>h-t),u=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],s=[];return i.forEach((h,t)=>{const n=e.filter(c=>c.FiscalYear===h),a=u.map(c=>{const g=n.find(b=>b.FiscalMonth===c);return g?g.PermitCount:0}),o=u;s.push({x:o,y:a,name:h.toString(),type:"bar",marker:{color:L[t%L.length]},text:a.map(c=>c>0?c.toString():""),textposition:"inside",insidetextanchor:"middle",textangle:-90,textfont:{size:11,color:"white",family:"sans-serif"},hovertemplate:`<b>%{x} ${h}</b><br>Permits: %{y}<extra></extra>`})}),s},[e,L]),S=r.useMemo(()=>{if(!e||e.length===0)return[];const u=[...new Set(e.map(s=>s.FiscalYear))].sort((s,h)=>h-s).slice(0,3);return e.filter(s=>u.includes(s.FiscalYear))},[e]),d=r.useMemo(()=>{if(!Array.isArray(S)||S.length===0)return[];const i=[...S].sort((t,n)=>{if(t.FiscalYear===n.FiscalYear){const a={Jan:1,Feb:2,Mar:3,Apr:4,May:5,Jun:6,Jul:7,Aug:8,Sep:9,Oct:10,Nov:11,Dec:12};return a[t.FiscalMonth]-a[n.FiscalMonth]}return t.FiscalYear-n.FiscalYear}),u=i.map(t=>`${t.FiscalYear}-${t.FiscalMonth}`),s=i.map(t=>t.PermitCount);return[{x:u,y:s,type:"scatter",mode:"lines+markers",name:"Permit Volume Trend",line:{color:L[0],width:3},marker:{size:8,color:L[0]},hovertemplate:"<b>%{x}</b><br>Volume: %{y:,} permits<extra></extra>"}]},[S,L]);r.useMemo(()=>{if(!e||e.length===0)return[];const i=[...new Set(e.map(h=>h.FiscalYear))].sort((h,t)=>h-t),u=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],s=[];return i.forEach((h,t)=>{const n=e.filter(c=>c.FiscalYear===h),a=u.map(c=>{const g=n.find(b=>b.FiscalMonth===c);return g?g.PermitCount:0}),o=u;s.push({x:o,y:a,name:h.toString(),type:"bar",marker:{color:L[t%L.length]},text:a.map(c=>c>0?c.toLocaleString():""),textposition:"outside",textangle:-90,textfont:{size:12,color:"black"},hovertemplate:`<b>%{x} ${h}</b><br>Permits: %{y}<extra></extra>`})}),s},[e,L]),r.useMemo(()=>{const i=new Map;return e.forEach(u=>{const s=u.FiscalYear;i.set(s,(i.get(s)||0)+u.PermitCount)}),Array.from(i).map(([u,s])=>({FiscalYear:u,PermitCount:s}))},[e]);const x=r.useCallback(i=>{const s=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][i-1];return e.filter(h=>h.FiscalMonth===s)},[e]),f=r.useMemo(()=>{if(!e||e.length===0)return 100;const i=Math.max(...e.map(u=>u.PermitCount||0),0);return Math.ceil(i/100)*100},[e]);return l.jsxs("div",{className:"monthly-analysis-section space-y-8",children:[l.jsxs("div",{className:"flex flex-col gap-8",children:[l.jsx("div",{className:"bg-white dark:bg-gray-800/50 p-4 rounded-lg shadow mb-8",id:"monthly-trend-report",children:l.jsx(A,{id:"chart0_Monthly_Trend",data:S,columns:P,isLoading:m,chartTitle:"Permit Volume by Unique Permit Numbers â€” Monthly Trend (Last 3 Years)",xAxisTitle:"Month",yAxisTitle:"Permit Volume",traces:d,chartType:"line",showTrendLine:!0,showAverageLine:!0,xAxisTickAngle:-45,showTablePanel:!0,initialSplitPos:80,initialTableWidth:350,tableHeaderClassName:"text-center",chartLayout:{showlegend:!1},excelFileName:"Monthly-Trend-Report.xlsx",chartFileName:"Monthly-Trend-Report.png",excelSheetName:"Monthly Trend Data",showPagination:!0,showChartTypeSwitcher:!1,disableHighlighting:!1,disableSelection:!1,showDataLabels:!0})}),l.jsx("div",{className:"bg-white dark:bg-gray-800/50 p-4 rounded-lg shadow mb-8",id:"monthly-grouped-report",children:l.jsx(A,{id:"chart1_monthly_grouped",data:e,columns:P,isLoading:m,chartTitle:"Permit Volume by Unique Permit Numbers â€” Monthly Volumes",xAxisTitle:"Fiscal Month",yAxisTitle:"Permit Volume",traces:F,barMode:"group",showTrendLine:!1,showAverageLine:!1,showBarLabels:!0,showDataLabels:!0,dataLabelPosition:"outside",barLabelFontColor:"black",excelFileName:"Monthly-Grouped-Report.xlsx",chartFileName:"Monthly-Grouped-Report.png",excelSheetName:"Monthly Grouped Data",showTablePanel:!0,initialSplitPos:80,initialTableWidth:350,tableHeaderClassName:"text-center",showPagination:!0,showChartTypeSwitcher:!1,disableHighlighting:!0,disableSelection:!0,chartLayout:{xaxis:{tickangle:-90},legend:{orientation:"h",yanchor:"bottom",y:-.3,xanchor:"center",x:.5}}})})]}),l.jsx("h3",{className:"text-xl font-semibold text-gray-800 dark:text-gray-200 mb-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:"Monthly Breakdown by Specific Month"}),l.jsxs("div",{id:"monthly-breakdown-grid",className:"grid grid-cols-2 grid-rows-6 gap-4 border border-gray-200 dark:border-gray-700",children:[" ",Array.from({length:12},(i,u)=>{const s=u+1,h=x(s);return l.jsx("div",{className:"border border-gray-200 dark:border-gray-700 p-2",children:l.jsx(A,{id:`chart_monthly_${s}`,data:h,columns:p,isLoading:m,chartTitle:`${J[s-1]} Permits`,xAxisTitle:"Fiscal Year",yAxisTitle:"Permit Count",xAccessor:"FiscalYear",yAccessor:"PermitCount",barMode:"group",barLabelPosition:"inside",barLabelInsideAnchor:"middle",showBarLabels:!0,initialChartType:"line",showDataLabels:!0,showTablePanel:!1,initialSplitPos:100,showChartTypeSwitcher:!0,hideSplitter:!0,showTableToggle:!1,baseBarColor:L[0],dataLabelFontColor:"black",barLabelFontColor:"white",chartLayout:{showlegend:!1,yaxis:{range:[0,f],fixedrange:!0,showgrid:!0,gridcolor:"rgba(200, 200, 200, 0.3)"},xaxis:{showgrid:!0,gridcolor:"rgba(200, 200, 200, 0.3)"}}})},`month-chart-${s}`)})]})]})}function he(){const{setTitle:e}=Z(),{reportType:m}=ee(),P=te(),[p,F]=r.useState([]),[S,d]=r.useState([]),[x,f]=r.useState([]),[i,u]=r.useState(!0),[s,h]=r.useState(null),[t,n]=r.useState(m||"annual"),[a,o]=r.useState([]),[c,g]=r.useState([]),[b,w]=r.useState([]),[Q,U]=r.useState(!0);r.useEffect(()=>{P(`/uniquepermits/${t}`,{replace:!0})},[t,P]),r.useEffect(()=>{m&&["annual","quarterly","monthly"].includes(m)&&n(m)},[m]),r.useEffect(()=>(re((()=>{switch(t){case"annual":return"AnnualUniquePermitsReport";case"quarterly":return"QuarterlyUniquePermitsReport";case"monthly":return"MonthlyUniquePermitsReport";default:return"default"}})(),e),()=>e("My Dashboard")),[e,t]);const v=r.useMemo(()=>{const y=new Set(p.map(C=>C.FiscalYear));return Array.from(y).sort((C,M)=>M-C)},[p]),D=r.useMemo(()=>[1,2,3,4],[]),k=r.useMemo(()=>["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],[]);r.useEffect(()=>{(async()=>{u(!0),h(null);try{const[C,M,Y]=await Promise.all([fetch("./data/UniquePermitsAnalysisData/UniquePermitYearlyJson.json"),fetch("./data/UniquePermitsAnalysisData/UniquePermitQuarterlyJson.json"),fetch("./data/UniquePermitsAnalysisData/UniquePermitMonthlyJson.json")]);if(!C.ok||!M.ok||!Y.ok)throw new Error("HTTP error during data fetch.");F(await C.json()),d(await M.json()),f(await Y.json())}catch(C){console.error("Failed to fetch unique permit data:",C),h("Failed to load analysis data.")}finally{u(!1)}})()},[]),r.useEffect(()=>{if(!i&&v.length>0){if(t==="monthly"){const y=[...v].slice(0,4);o(y)}else o([...v]);g(D),w(k)}},[i,v,D,k,t]);const _=y=>r.useCallback((C,M)=>{y(Y=>M?[...Y,C]:Y.filter(B=>B!==C))},[]),z=_(o),G=_(g),I=_(w),j=r.useCallback((y,C)=>{let M=y;a.length>0&&(M=M.filter(q=>a.includes(q.FiscalYear)));const Y=c.length===D.length;C!=="annual"&&c.length>0&&!Y&&(M=M.filter(q=>c.includes(q.FiscalQuarter)));const B=b.length===k.length;return C==="monthly"&&b.length>0&&!B&&(M=M.filter(q=>b.includes(q.FiscalMonth))),M},[a,c,b,D.length,k.length]),W=r.useMemo(()=>j(p,"annual"),[p,j]),K=r.useMemo(()=>j(S,"quarterly"),[S,j]),X=r.useMemo(()=>j(x,"monthly"),[x,j]);return l.jsxs("div",{className:"unique-permits-dashboard",id:"unique-permits-dashboard",children:[s&&l.jsx("div",{className:"text-red-600 dark:text-red-400 text-center text-lg mb-4",children:s}),l.jsxs("div",{className:"flex flex-col gap-4",children:[l.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-4",children:l.jsxs("div",{className:"flex flex-wrap gap-4",children:[l.jsx(H,{label:"Select Years",options:v.map(y=>({label:String(y),value:y})),selectedValues:a,onChange:z}),t!=="annual"&&l.jsx(H,{label:"Select Quarters",options:D.map(y=>({label:`Q${y}`,value:y})),selectedValues:c,onChange:G}),t==="monthly"&&l.jsx(H,{label:"Select Months",options:k.map(y=>({label:y,value:y})),selectedValues:b,onChange:I})]})}),l.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-4",children:i?l.jsx("div",{className:"flex items-center justify-center h-64",children:l.jsx(ae,{className:"animate-spin text-blue-500 text-4xl"})}):l.jsxs(l.Fragment,{children:[t==="annual"&&l.jsx(le,{data:W}),t==="quarterly"&&l.jsx(ne,{data:K}),t==="monthly"&&l.jsx(oe,{data:X})]})})]})]})}export{he as default};
